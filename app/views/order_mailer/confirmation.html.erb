<h2 style="margin: 0 0 20px 0; font-size: 22px; color: #1a1a1a;">Order Confirmation</h2>

<p style="margin: 0 0 8px 0; font-size: 15px; color: #333333; line-height: 1.6;">
  <%= I18n.t("mailers.order_mailer.confirmation.greeting", name: @order.name) %>
</p>
<p style="margin: 0 0 25px 0; font-size: 15px; color: #333333; line-height: 1.6;">
  <%= I18n.t("mailers.order_mailer.confirmation.body", id: @order.id, total: number_to_currency(@order.total_amount, unit: @order.currency)) %>
</p>

<!-- Order info -->
<table width="100%" cellpadding="0" cellspacing="0" style="margin-bottom: 25px; font-size: 14px; color: #333333;">
  <tr>
    <td style="padding: 4px 0;"><strong>Order Number:</strong> #<%= @order.id %></td>
  </tr>
  <tr>
    <td style="padding: 4px 0;"><strong>Date:</strong> <%= @order.created_at.strftime('%B %d, %Y') %></td>
  </tr>
  <tr>
    <td style="padding: 4px 0;"><strong>Status:</strong> <%= @order.status.titleize %></td>
  </tr>
</table>

<!-- Items table -->
<table width="100%" cellpadding="0" cellspacing="0" style="margin-bottom: 25px; border-collapse: collapse;">
  <tr>
    <td style="background-color: #333333; color: #ffffff; padding: 10px 12px; font-size: 13px; font-weight: bold;">Description</td>
    <td style="background-color: #333333; color: #ffffff; padding: 10px 12px; font-size: 13px; font-weight: bold; text-align: center;">Qty</td>
    <td style="background-color: #333333; color: #ffffff; padding: 10px 12px; font-size: 13px; font-weight: bold; text-align: right;">Unit Price</td>
    <td style="background-color: #333333; color: #ffffff; padding: 10px 12px; font-size: 13px; font-weight: bold; text-align: right;">Cost</td>
  </tr>
  <% @order.order_items.each do |item| %>
    <tr>
      <td style="padding: 12px; border-bottom: 1px solid #e4e4e7; font-size: 14px; color: #333333;">
        <%= item.product.name(I18n.locale) %>
        <% if item.product_variant %>
          <br><span style="font-size: 12px; color: #888888;"><%= item.product_variant.display_name %></span>
        <% end %>
        <% if item.is_preorder %>
          <br><span style="font-size: 11px; color: #b45309; font-weight: bold;">PRE-ORDER</span>
        <% end %>
      </td>
      <td style="padding: 12px; border-bottom: 1px solid #e4e4e7; font-size: 14px; color: #333333; text-align: center;"><%= item.quantity %></td>
      <td style="padding: 12px; border-bottom: 1px solid #e4e4e7; font-size: 14px; color: #333333; text-align: right;"><%= number_to_currency(item.unit_price, unit: @order.currency) %></td>
      <td style="padding: 12px; border-bottom: 1px solid #e4e4e7; font-size: 14px; color: #333333; text-align: right;"><%= number_to_currency(item.line_total, unit: @order.currency) %></td>
    </tr>
  <% end %>
</table>

<!-- Totals -->
<table width="100%" cellpadding="0" cellspacing="0" style="margin-bottom: 25px;">
  <tr>
    <td width="60%"></td>
    <td width="40%">
      <table width="100%" cellpadding="0" cellspacing="0" style="font-size: 14px; color: #333333;">
        <tr>
          <td style="padding: 6px 0;">Subtotal</td>
          <td style="padding: 6px 0; text-align: right;"><%= number_to_currency(@order.subtotal, unit: @order.currency) %></td>
        </tr>
        <tr>
          <td style="padding: 6px 0;">Shipping (<%= @order.shipping_method.presence || "DHL" %> Express)</td>
          <td style="padding: 6px 0; text-align: right;"><%= number_to_currency(@order.shipping_amount, unit: @order.currency) %></td>
        </tr>
        <% if @order.discount_amount.to_f > 0 %>
          <tr>
            <td style="padding: 6px 0; color: #059669;">Discount (<%= @order.coupon_code %>)</td>
            <td style="padding: 6px 0; text-align: right; color: #059669;">-<%= number_to_currency(@order.discount_amount, unit: @order.currency) %></td>
          </tr>
        <% end %>
        <tr>
          <td colspan="2" style="border-top: 1px solid #e4e4e7; padding-top: 10px;"></td>
        </tr>
        <tr>
          <td style="padding: 6px 0; font-size: 16px; font-weight: bold; color: #1a1a1a;">Total</td>
          <td style="padding: 6px 0; font-size: 16px; font-weight: bold; color: #1a1a1a; text-align: right;"><%= number_to_currency(@order.total_amount, unit: @order.currency) %></td>
        </tr>
      </table>
    </td>
  </tr>
</table>

<% if @order.has_preorder_items? %>
  <div style="background-color: #fef3c7; border-left: 4px solid #f59e0b; padding: 15px; margin-bottom: 25px; font-size: 14px; color: #92400e;">
    <strong><%= I18n.t("mailers.order_mailer.confirmation.preorder_notice") %></strong>
    <p style="margin: 8px 0 0 0;"><%= Setting.current.preorder_disclaimer(I18n.locale) %></p>
    <% if @order.order_items.preorders.any? && @order.order_items.regular_orders.any? %>
      <p style="margin: 8px 0 0 0;"><%= I18n.t("mailers.order_mailer.confirmation.ship_together") %></p>
    <% end %>
  </div>
<% end %>

<!-- Shipping address -->
<div style="background-color: #f9fafb; border-radius: 4px; padding: 15px; margin-bottom: 10px;">
  <p style="margin: 0 0 8px 0; font-size: 13px; font-weight: bold; color: #1a1a1a; text-transform: uppercase;">Shipping Address</p>
  <p style="margin: 0; font-size: 14px; color: #555555; line-height: 1.6;">
    <% if @order.street_address.present? %>
      <%= @order.street_address %><br>
      <% if @order.building.present? %><%= @order.building %><br><% end %>
      <%= [@order.city, @order.postal_code].compact_blank.join(", ") %><br>
      <%= @order.country %>
    <% else %>
      <%= @order.address_text %><br>
      <%= @order.city %>, <%= @order.country %>
    <% end %>
  </p>
</div>
