<%= form_with(model: [:admin, @page], local: true, class: "space-y-6") do |form| %>
  <!-- Basic Information Section -->
  <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
      <svg class="w-5 h-5 mr-2 text-[#465FFF]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <%= t("admin.pages.basic_info", default: "Basic Information") %>
    </h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <%= form.label :title_en, class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.text_field :title_en,
          class: "block w-full px-4 py-2.5 text-sm text-gray-900 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#465FFF] focus:border-[#465FFF] transition-colors",
          placeholder: "Enter page title in English" %>
      </div>

      <div>
        <%= form.label :title_ar, class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.text_field :title_ar,
          class: "block w-full px-4 py-2.5 text-sm text-gray-900 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#465FFF] focus:border-[#465FFF] transition-colors",
          placeholder: "أدخل عنوان الصفحة بالعربية" %>
      </div>

      <div>
        <%= form.label :slug, class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.text_field :slug,
          class: "block w-full px-4 py-2.5 text-sm text-gray-900 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#465FFF] focus:border-[#465FFF] transition-colors",
          placeholder: "page-url-slug" %>
        <p class="mt-1 text-xs text-gray-500">URL-friendly version of the page title</p>
      </div>

      <div class="flex items-start pt-8">
        <div class="flex items-center h-5">
          <%= form.check_box :active,
            class: "w-4 h-4 text-[#465FFF] bg-gray-100 border-gray-300 rounded focus:ring-[#465FFF] focus:ring-2" %>
        </div>
        <div class="ml-3">
          <%= form.label :active, class: "text-sm font-medium text-gray-700" %>
          <p class="text-xs text-gray-500">Make this page visible on the website</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Page Content Section -->
  <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
      <svg class="w-5 h-5 mr-2 text-[#465FFF]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/>
      </svg>
      <%= t("admin.pages.content", default: "Page Content") %>
    </h3>

    <div class="space-y-6">
      <div>
        <%= form.label :content_en, t("admin.pages.content_en", default: "Content (English)"), class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.text_area :content_en, rows: 15,
          id: "content_en_editor",
          class: "block w-full px-4 py-2.5 text-sm text-gray-900 border border-gray-300 rounded-lg tinymce-editor" %>
      </div>

      <div>
        <%= form.label :content_ar, t("admin.pages.content_ar", default: "Content (Arabic)"), class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.text_area :content_ar, rows: 15,
          id: "content_ar_editor",
          class: "block w-full px-4 py-2.5 text-sm text-gray-900 border border-gray-300 rounded-lg tinymce-editor" %>
      </div>
    </div>
  </div>

  <!-- Form Actions -->
  <div class="flex items-center justify-between pt-4">
    <%= link_to admin_pages_path(locale: I18n.locale),
      class: "inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors" do %>
      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      <%= t("common.cancel", default: "Cancel") %>
    <% end %>

    <%= form.submit t("admin.actions.save"),
      class: "inline-flex items-center px-6 py-2.5 bg-[#465FFF] hover:bg-[#3651E6] text-white font-medium rounded-lg shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#465FFF]" %>
  </div>
<% end %>

<script>
  // Initialize TinyMCE when the page loads (works with Turbo)
  document.addEventListener('turbo:load', initializeTinyMCE);
  document.addEventListener('DOMContentLoaded', initializeTinyMCE);

  function initializeTinyMCE() {
    // Remove existing instances to prevent duplicates
    if (typeof tinymce !== 'undefined') {
      tinymce.remove();
    }

    // Common configuration for both editors
    const commonConfig = {
      height: 500,
      menubar: true,
      plugins: [
        'anchor', 'autolink', 'charmap', 'codesample', 'emoticons', 'link', 'lists', 'media',
        'searchreplace', 'table', 'visualblocks', 'wordcount', 'code', 'fullscreen', 'preview',
        'insertdatetime', 'advlist', 'help', 'image', 'quickbars', 'directionality'
      ],
      toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | ' +
        'forecolor backcolor | alignleft aligncenter alignright alignjustify | ' +
        'numlist bullist outdent indent | link image media table | emoticons charmap codesample | ' +
        'code visualblocks | removeformat | fullscreen preview help',
      image_advtab: true,
      file_picker_types: 'image',
      automatic_uploads: false,
      content_style: 'body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; font-size: 14px; line-height: 1.6; padding: 10px; }'
    };

    // Initialize English editor
    if (document.getElementById('content_en_editor')) {
      tinymce.init({
        ...commonConfig,
        selector: '#content_en_editor',
        directionality: 'ltr'
      });
    }

    // Initialize Arabic editor
    if (document.getElementById('content_ar_editor')) {
      tinymce.init({
        ...commonConfig,
        selector: '#content_ar_editor',
        directionality: 'rtl',
        language: 'ar',
        language_url: '/tinymce/langs/ar.js',
        content_style: 'body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; font-size: 14px; direction: rtl; text-align: right; line-height: 1.6; padding: 10px; }'
      });
    }
  }

  // Clean up when navigating away with Turbo
  document.addEventListener('turbo:before-cache', function() {
    if (typeof tinymce !== 'undefined') {
      tinymce.remove();
    }
  });
</script>
