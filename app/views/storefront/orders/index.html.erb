<% content_for :full_width, true %>

<div x-data="{ activeTab: 'orders' }" class="min-h-screen bg-gray-50 py-10">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
      <div>
        <p class="text-sm uppercase tracking-[0.2em] text-gray-500 mb-1"><%= t("orders.account", default: "My Account") %></p>
        <h1 class="text-4xl font-bold text-gray-900"><%= t("orders.my_orders", default: "My Orders") %></h1>
        <p class="text-gray-600"><%= t("orders.welcome_back", default: "Manage your orders, profile, and security in one place.") %></p>
      </div>
      <div class="flex gap-3">
        <div class="px-4 py-3 bg-white border border-gray-200 rounded-2xl shadow-sm text-center">
          <div class="text-sm text-gray-500"><%= t("orders.total_spent", default: "Total Spent") %></div>
          <div class="text-xl font-semibold text-gray-900">
            <%= number_to_currency(@orders.sum(&:total_amount), unit: current_settings.default_currency) %>
          </div>
        </div>
        <div class="px-4 py-3 bg-white border border-gray-200 rounded-2xl shadow-sm text-center">
          <div class="text-sm text-gray-500"><%= t("orders.orders_count", default: "Orders") %></div>
          <div class="text-xl font-semibold text-gray-900"><%= @orders.count %></div>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
      <!-- Sidebar -->
      <aside class="bg-white rounded-2xl shadow-sm border border-gray-200 p-4 space-y-3">
        <% nav_items = [
          { key: 'orders', label: t("orders.my_orders", default: "My Orders"), icon: 'M3 3h18v18H3z' },
          { key: 'profile', label: t("profile.details", default: "Profile"), icon: 'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z' },
          { key: 'security', label: t("profile.security", default: "Password"), icon: 'M12 11c-1.657 0-3 1.343-3 3v3h6v-3c0-1.657-1.343-3-3-3z M8 11V9a4 4 0 118 0v2' }
        ] %>
        <% nav_items.each do |item| %>
          <button @click="activeTab = '<%= item[:key] %>'"
                  :class="activeTab === '<%= item[:key] %>' ? 'bg-gray-900 text-white shadow-lg' : 'border border-gray-200 text-gray-700 hover:border-gray-300'"
                  class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="<%= item[:icon] %>" />
            </svg>
            <span class="text-sm font-semibold"><%= item[:label] %></span>
          </button>
        <% end %>
      </aside>

      <!-- Content -->
      <div class="lg:col-span-3 space-y-6">
        <!-- Orders Tab -->
        <div x-show="activeTab === 'orders'" x-transition class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 space-y-4">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-2xl font-bold text-gray-900"><%= t("orders.my_orders", default: "My Orders") %></h2>
              <p class="text-gray-600 text-sm"><%= t("orders.subtitle", default: "Track, view, and manage your purchases") %></p>
            </div>
          </div>

          <% if @orders.any? %>
            <div class="space-y-4">
              <% @orders.each do |order| %>
                <% status_colors = {
                  "pending" => "bg-yellow-100 text-yellow-800",
                  "payment_pending" => "bg-orange-100 text-orange-800",
                  "paid" => "bg-emerald-100 text-emerald-800",
                  "shipped" => "bg-blue-100 text-blue-800",
                  "delivered" => "bg-indigo-100 text-indigo-800",
                  "canceled" => "bg-red-100 text-red-700"
                } %>
                <div class="border border-gray-200 rounded-xl p-4 hover:shadow-md transition-shadow duration-200">
                  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                    <div class="space-y-1">
                      <div class="flex items-center gap-2 text-sm text-gray-500">
                        <span class="font-semibold text-gray-900">#<%= order.id %></span>
                        <span>â€¢</span>
                        <span><%= l(order.created_at, format: :short) %></span>
                      </div>
                      <div class="flex items-center gap-3">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold <%= status_colors[order.status] || 'bg-gray-100 text-gray-800' %>">
                          <%= order.status.titleize %>
                        </span>
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-700">
                          <%= t("orders.payment_status", default: "Payment") %>: <%= order.payment_status.titleize %>
                        </span>
                      </div>
                      <div class="text-sm text-gray-600">
                        <%= t("orders.items_count", default: "Items") %>: <%= order.order_items.sum(&:quantity) %>
                      </div>
                    </div>

                    <div class="flex items-center gap-3">
                      <div class="text-right">
                        <div class="text-xs text-gray-500"><%= t("orders.total", default: "Total") %></div>
                        <div class="text-2xl font-bold text-gray-900"><%= number_to_currency(order.total_amount, unit: current_settings.default_currency) %></div>
                      </div>
                      <div class="flex flex-col sm:flex-row gap-2">
                        <%= link_to t("orders.view", default: "View"), order_path(order, locale: I18n.locale),
                          class: "inline-flex items-center justify-center px-4 py-2 rounded-lg border border-gray-300 text-sm font-semibold text-gray-800 hover:bg-gray-50" %>
                        <% if ["pending", "payment_pending"].include?(order.status) %>
                          <%= button_to cancel_order_path(order, locale: I18n.locale), method: :patch,
                            form: { data: { turbo_confirm: t("orders.confirm_cancel", default: "Cancel this order?") } },
                            class: "inline-flex items-center justify-center px-4 py-2 rounded-lg bg-red-600 text-white text-sm font-semibold hover:bg-red-700" do %>
                            <%= t("orders.cancel", default: "Cancel") %>
                          <% end %>
                        <% end %>
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="text-center py-12 border border-dashed border-gray-300 rounded-2xl bg-gray-50">
              <p class="text-lg font-semibold text-gray-900 mb-2"><%= t("orders.empty", default: "No orders yet") %></p>
              <p class="text-gray-600 mb-6"><%= t("orders.empty_cta", default: "Discover our latest pieces and start shopping") %></p>
              <%= link_to t("home.shop_now", default: "Shop Now"), root_path(locale: I18n.locale),
                class: "inline-flex items-center px-6 py-3 bg-gray-900 text-white rounded-full font-semibold hover:bg-black transition" %>
            </div>
          <% end %>
        </div>

        <!-- Profile Tab -->
        <div x-show="activeTab === 'profile'" x-transition class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 space-y-6">
          <div>
            <h2 class="text-2xl font-bold text-gray-900"><%= t("profile.details", default: "Profile Details") %></h2>
            <p class="text-gray-600 text-sm"><%= t("profile.details_sub", default: "Update your personal information") %></p>
          </div>
          <%= form_with model: current_user, url: user_registration_path(locale: I18n.locale), method: :put, local: true, class: "grid grid-cols-1 md:grid-cols-2 gap-4" do |f| %>
            <div>
              <%= f.label :name, class: "text-sm text-gray-600" %>
              <%= f.text_field :name, class: "mt-1 w-full rounded-lg border-gray-300" %>
            </div>
            <div>
              <%= f.label :email, class: "text-sm text-gray-600" %>
              <%= f.email_field :email, class: "mt-1 w-full rounded-lg border-gray-300" %>
            </div>
            <div>
              <%= f.label :phone, class: "text-sm text-gray-600" %>
              <%= f.text_field :phone, class: "mt-1 w-full rounded-lg border-gray-300" %>
            </div>
            <div>
              <%= f.label :default_country, t("profile.country", default: "Country"), class: "text-sm text-gray-600" %>
              <%= f.text_field :default_country, class: "mt-1 w-full rounded-lg border-gray-300" %>
            </div>
            <div>
              <%= f.label :default_city, t("profile.city", default: "City"), class: "text-sm text-gray-600" %>
              <%= f.text_field :default_city, class: "mt-1 w-full rounded-lg border-gray-300" %>
            </div>
            <div class="md:col-span-2">
              <%= f.label :default_address, t("profile.address", default: "Address"), class: "text-sm text-gray-600" %>
              <%= f.text_field :default_address, class: "mt-1 w-full rounded-lg border-gray-300" %>
            </div>
            <div class="md:col-span-2">
              <%= f.label :current_password, t("devise.current_password", default: "Current password"), class: "text-sm text-gray-600" %>
              <%= f.password_field :current_password, autocomplete: "current-password", class: "mt-1 w-full rounded-lg border-gray-300" %>
              <p class="text-xs text-gray-500 mt-1"><%= t("profile.current_password_hint", default: "Required to save profile changes") %></p>
            </div>
            <div class="md:col-span-2 flex justify-end">
              <%= f.submit t("profile.save", default: "Save Changes"), class: "px-6 py-3 bg-gray-900 text-white rounded-lg font-semibold hover:bg-black" %>
            </div>
          <% end %>
        </div>

        <!-- Security Tab -->
        <div x-show="activeTab === 'security'" x-transition class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 space-y-6">
          <div>
            <h2 class="text-2xl font-bold text-gray-900"><%= t("profile.security", default: "Password & Security") %></h2>
            <p class="text-gray-600 text-sm"><%= t("profile.security_sub", default: "Update your password to keep your account safe") %></p>
          </div>
          <%= form_with model: current_user, url: user_registration_path(locale: I18n.locale), method: :put, local: true, class: "space-y-4 max-w-xl" do |f| %>
            <div>
              <%= f.label :current_password, t("devise.current_password", default: "Current password"), class: "text-sm text-gray-600" %>
              <%= f.password_field :current_password, autocomplete: "current-password", class: "mt-1 w-full rounded-lg border-gray-300" %>
            </div>
            <div>
              <%= f.label :password, t("devise.password", default: "New password"), class: "text-sm text-gray-600" %>
              <%= f.password_field :password, autocomplete: "new-password", class: "mt-1 w-full rounded-lg border-gray-300" %>
            </div>
            <div>
              <%= f.label :password_confirmation, t("devise.password_confirmation", default: "Confirm new password"), class: "text-sm text-gray-600" %>
              <%= f.password_field :password_confirmation, autocomplete: "new-password", class: "mt-1 w-full rounded-lg border-gray-300" %>
            </div>
            <div class="flex justify-end">
              <%= f.submit t("profile.update_password", default: "Update Password"), class: "px-6 py-3 bg-gray-900 text-white rounded-lg font-semibold hover:bg-black" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
