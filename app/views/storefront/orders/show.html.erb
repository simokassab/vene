<% content_for :full_width, true %>

<div class="min-h-screen bg-gray-50 pb-10">
  <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6 pt-32 md:pt-36">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-sm uppercase tracking-[0.2em] text-gray-500 mb-1"><%= t("orders.details", default: "Order Details") %></p>
        <h1 class="text-4xl font-bold text-gray-900">#<%= @order.id %></h1>
        <p class="text-gray-600"><%= l(@order.created_at, format: :long) %></p>
      </div>
      <div class="flex gap-2">
        <%= link_to t("orders.invoice", default: "Invoice"), invoice_order_path(@order, locale: I18n.locale),
          class: "inline-flex items-center px-4 py-2 rounded-lg border border-gray-300 text-gray-800 font-semibold hover:bg-gray-50" %>
        <% if ["pending", "payment_pending"].include?(@order.status) %>
          <%= button_to cancel_order_path(@order, locale: I18n.locale), method: :patch,
            form: { data: { turbo_confirm: t("orders.confirm_cancel", default: "Cancel this order?") } },
            class: "inline-flex items-center px-4 py-2 rounded-lg bg-red-600 text-white font-semibold hover:bg-red-700" do %>
            <%= t("orders.cancel", default: "Cancel Order") %>
          <% end %>
        <% end %>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <% status_colors = {
        "pending" => "bg-yellow-100 text-yellow-800",
        "payment_pending" => "bg-orange-100 text-orange-800",
        "paid" => "bg-emerald-100 text-emerald-800",
        "shipped" => "bg-blue-100 text-blue-800",
        "delivered" => "bg-indigo-100 text-indigo-800",
        "canceled" => "bg-red-100 text-red-700"
      } %>
      <div class="bg-white border border-gray-200 rounded-2xl p-4 shadow-sm space-y-2">
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-lg font-semibold text-gray-900"><%= t("orders.status", default: "Status") %></h2>
          <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold <%= status_colors[@order.status] || 'bg-gray-100 text-gray-800' %>">
            <%= @order.status.titleize %>
          </span>
        </div>
        <p class="text-sm text-gray-600"><%= t("orders.payment_status", default: "Payment") %>: <%= @order.payment_status.titleize %></p>
        <p class="text-sm text-gray-600">DHL: <%= @order.dhl_tracking_id.presence || '-' %></p>
      </div>

      <div class="bg-white border border-gray-200 rounded-2xl p-4 shadow-sm">
        <h2 class="text-lg font-semibold text-gray-900 mb-2"><%= t("orders.shipping_address", default: "Shipping Address") %></h2>
        <p class="text-sm text-gray-800"><%= @order.name %></p>
        <p class="text-sm text-gray-600"><%= @order.address %>, <%= @order.city %>, <%= @order.country %></p>
        <p class="text-sm text-gray-600"><%= @order.phone %></p>
      </div>
    </div>

    <div class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold text-gray-900"><%= t("orders.items", default: "Items") %></h2>
        <div class="text-right">
          <div class="text-sm text-gray-500"><%= t("orders.total", default: "Total") %></div>
          <div class="text-2xl font-bold text-gray-900"><%= number_to_currency(@order.total_amount, unit: current_settings.default_currency) %></div>
        </div>
      </div>

      <div class="divide-y divide-gray-200">
        <% @order.order_items.each do |item| %>
          <div class="py-4 flex items-start justify-between gap-4">
            <div>
              <div class="font-semibold text-gray-900"><%= item.product.name(I18n.locale) %></div>
              <% if item.product_variant %>
                <div class="text-sm font-medium text-gray-700"><%= item.product_variant.display_name %></div>
              <% end %>
              <div class="text-sm text-gray-500"><%= t("orders.qty", default: "Qty") %>: <%= item.quantity %></div>
            </div>
            <div class="text-right">
              <div class="text-sm text-gray-600"><%= number_to_currency(item.unit_price, unit: current_settings.default_currency) %> <span class="text-xs text-gray-500">x <%= item.quantity %></span></div>
              <div class="text-lg font-bold text-gray-900"><%= number_to_currency(item.line_total, unit: current_settings.default_currency) %></div>
            </div>
          </div>
        <% end %>
      </div>

      <div class="mt-6 border-t border-gray-200 pt-4 space-y-2 text-right">
        <div class="text-sm text-gray-600">
          <span><%= t("orders.subtotal", default: "Subtotal") %></span>
          <span class="ml-3 font-semibold text-gray-900"><%= number_to_currency(@order.subtotal, unit: current_settings.default_currency) %></span>
        </div>
        <div class="text-sm text-gray-600">
          <span><%= t("orders.shipping", default: "Shipping") %></span>
          <span class="ml-3 font-semibold text-gray-900"><%= number_to_currency(@order.shipping_amount, unit: current_settings.default_currency) %></span>
        </div>
        <% if @order.discount_amount > 0 %>
          <div class="text-sm text-green-600">
            <span><%= t("coupons.discount", default: "Discount") %> (<span class="font-mono"><%= @order.coupon_code %></span>)</span>
            <span class="ml-3 font-semibold">-<%= number_to_currency(@order.discount_amount, unit: current_settings.default_currency) %></span>
          </div>
        <% end %>
        <div class="text-lg font-bold text-gray-900">
          <span><%= t("orders.total", default: "Total") %></span>
          <span class="ml-3"><%= number_to_currency(@order.total_amount, unit: current_settings.default_currency) %></span>
        </div>
        <div class="text-xs text-gray-500 mt-2">
          <%= t("common.prices_include_tax", default: "Prices include all applicable taxes") %>
        </div>
      </div>
    </div>
  </div>
</div>
